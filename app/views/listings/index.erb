
  <% search = Listing.joins(:pokemon).where("pokemons.name ILIKE '%#{params[:keyword]}%'") %> 
  <% if params[:show_all] == "true" %>
    <% search = Listing.all %>
  <% end %>

  <% if search.any? %>
    <table class="table">
      <thead>
        <th>Pokeman for Sale</th>
        <th>I'm looking for</th>
        <th>Price</th>
      </thead>
      <tbody>
        <% search.each do |listing|%>
          <tr>
          <% p = listing.pokemon %>
          <% pt = listing.pokemon_trade %>
          <td><img src="<%= p.image_url %>"><%= p.name %></td>
          <td><%= pt ? "<img src=\"#{pt.image_url}\">" : nil %><%= pt ? pt.name : nil %></td>
          <td><%= pt ? (listing.price / 100.00).round(2) : 0 %>$</td>
          <td>
            <form method="post" action="listings/add_to_cart">
              <input type="hidden" name="listing_id" value=<%= listing.id %> >
              <button class="btn btn-primary">Add to cart</button>
            </form>
          </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p>No result found</p>
  <% end %>

